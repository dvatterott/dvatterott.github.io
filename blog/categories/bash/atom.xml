<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Bash | Dan Vatterott]]></title>
  <link href="https://danvatterott.com/blog/categories/bash/atom.xml" rel="self"/>
  <link href="https://danvatterott.com/"/>
  <updated>2022-02-25T14:33:11-06:00</updated>
  <id>https://danvatterott.com/</id>
  <author>
    <name><![CDATA[Dan Vatterott]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Are Some Mlb Players More Likely to Hit Into Errors Than Others: Data Munging]]></title>
    <link href="https://danvatterott.com/blog/2019/04/19/are-some-mlb-players-more-likely-to-hit-into-errors-munging/"/>
    <updated>2019-04-19T11:02:56-05:00</updated>
    <id>https://danvatterott.com/blog/2019/04/19/are-some-mlb-players-more-likely-to-hit-into-errors-munging</id>
    <content type="html"><![CDATA[<p>I recently found myself wondering if some baseball players are more likely to hit into errors than others. In theory, the answer should be “no” since fielders produce errors regardless of who is hitting. Nonetheless, it’s also possible that some hitters “force” errors by hitting the ball harder or running to first base faster.</p>

<p>In order to evaluate this possibility, I found play-by-play data on <a href="https://www.retrosheet.org/">retrosheet.org</a>. This data contains row by row data describing each event (e.g., a hit, stolen base etc) in a baseball game. I’ve posted this analysis on <a href="https://github.com/dvatterott/mlb_errors">github</a> and will walk through it here.</p>

<p>The user is expected to input what year’s data they want. I write the code’s output for the year 2018 as comments. The code starts by downloading and unzipping the data.</p>

<p>{% codeblock lang:bash %}
YEAR=$1
FILE_LOC=https://www.retrosheet.org/events/${YEAR}eve.zip</p>

<p>echo “———DOWNLOAD———-“
wget -nc $FILE_LOC -O ./raw_data/${YEAR}.zip</p>

<p>echo “———UNPACK———-“
mkdir raw_data/${YEAR}/
unzip -o raw_data/${YEAR}.zip -d raw_data/${YEAR}/
{% endcodeblock %}</p>

<p>The unzipped data contain play-by-play data in files with the EVN or EVA extensions. Each team’s home stadium has its own file. I combine all the play-by play eveSSplants (.EVN and .EVA files) into a single file. I then remove all non batting events (e.g., balk, stolen base etc).</p>

<p>I also combine all the roster files (.ROS) into a single file.</p>

<p>{% codeblock lang:bash %}
# export playbyplay to single file
mkdir processed_data/${YEAR}/
find raw_data/${YEAR}/ -regex ‘.*EV[A|N]’ | \
	xargs grep play &gt; \
	./processed_data/${YEAR}/playbyplay.out</p>

<h1 id="get-all-plate-appearances-from-data-and-hitter-remove-all-non-plate-appearance-rows">get all plate appearances from data (and hitter). remove all non plate appearance rows</h1>
<p>cat ./processed_data/${YEAR}/playbyplay.out | \
	awk -F’,’ ‘{print $4”,”$7}’ | \
	grep -Ev ‘,[A-Z]{3}[0-9]{2}’ | \
	grep -Ev ‘,(NP|BK|CS|DI|OA|PB|WP|PO|POCS|SB|FLE)’ &gt; \
	./processed_data/${YEAR}/batters.out</p>

<h1 id="one-giant-roster-file">one giant roster file</h1>
<p>find raw_data/${YEAR}/ -name ‘*ROS’ | \
	xargs awk -F’,’ ‘{print $1” “$2” “$3}’ &gt; \
	./processed_data/${YEAR}/players.out
{% endcodeblock %}</p>

<p>In this next few code blocks I print some data just to see what I am working with. For instance, I print out players with the most plate appearances. I was able to confirm these numbers with <a href="https://baseball-reference.com">baseball-reference</a>. This operation requires me to groupby player and count the rows. I join this file with the roster file to get player’s full names.</p>

<p>{% codeblock lang:bash %}
echo “———PLAYERS WITH MOST PLATE APPEARANCES———-“
cat ./processed_data/${YEAR}/batters.out | \
	awk -F, ‘{a[$1]++;}END{for (i in a)print i, a[i];}’ | \
	sort -k2 -nr | \
	head &gt; \
	./processed_data/${YEAR}/most_pa.out
join &lt;(sort -k 1 ./processed_data/${YEAR}/players.out) &lt;(sort -k 1 ./processed_data/${YEAR}/most_pa.out) | \
	uniq | \
	sort -k 4 -nr | \
	head | \
	awk ‘{print $3”, “$2”, “$4}’</p>

<h1 id="players-with-most-plate-appearances----------">———PLAYERS WITH MOST PLATE APPEARANCES———-</h1>
<p>#Francisco, Lindor, 745
#Trea, Turner, 740
#Manny, Machado, 709
#Cesar, Hernandez, 708
#Whit, Merrifield, 707
#Freddie, Freeman, 707
#Giancarlo, Stanton, 706
#Nick, Markakis, 705
#Alex, Bregman, 705
#Marcus, Semien, 703
{% endcodeblock %}</p>

<p>Here’s the players with the most hits. Notice that I filter out all non-hits in the grep, then group by player.</p>

<p>{% codeblock lang:bash %}
echo “———PLAYERS WITH MOST HITS———-“
cat ./processed_data/${YEAR}/batters.out | \
	grep -E ‘,(S|D|T|HR)’ | \
	awk -F, ‘{a[$1]++;}END{for (i in a)print i, a[i];}’ | \
	sort -k2 -nr | \
	head</p>

<h1 id="players-with-most-hits----------">———PLAYERS WITH MOST HITS———-</h1>
<p>#merrw001 192
#freef001 191
#martj006 188
#machm001 188
#yelic001 187
#markn001 185
#castn001 185
#lindf001 183
#peraj003 182
#blacc001 182
{% endcodeblock %}</p>

<p>Here’s the players with the most at-bats.</p>

<p>{% codeblock lang:bash %}
echo “———PLAYERS WITH MOST AT BATS———-“
cat ./processed_data/${YEAR}/batters.out | \
	grep -Ev ‘SF|SH’ | \
	grep -E ‘,(S|D|T|HR|K|[0-9]|E|DGR|FC)’ | \
	awk -F, ‘{a[$1]++;}END{for (i in a)print i, a[i];}’ &gt; \
	./processed_data/${YEAR}/abs.out
cat ./processed_data/${YEAR}/abs.out | sort -k2 -nr | head</p>

<h1 id="players-with-most-at-bats----------">———PLAYERS WITH MOST AT BATS———-</h1>
<p>#turnt001 664
#lindf001 661
#albio001 639
#semim001 632
#peraj003 632
#merrw001 632
#machm001 632
#blacc001 626
#markn001 623
#castn001 620
{% endcodeblock %}</p>

<p>And, finally, here’s the players who hit into the most errors.</p>

<p>{% codeblock lang:bash %}
echo “———PLAYERS WHO HIT INTO THE MOST ERRORS———-“
cat ./processed_data/${YEAR}/batters.out | \
    	grep -Ev ‘SF|SH’ | \
	grep ‘,E[0-9]’ | \
	awk -F, ‘{a[$1]++;}END{for (i in a)print i, a[i];}’ &gt; \
	./processed_data/${YEAR}/errors.out
cat ./processed_data/${YEAR}/errors.out | sort -k2 -nr | head</p>

<h1 id="players-who-hit-into-the-most-errors----------">———PLAYERS WHO HIT INTO THE MOST ERRORS———-</h1>
<p>#gurry001 13
#casts001 13
#baezj001 12
#goldp001 11
#desmi001 11
#castn001 10
#bogax001 10
#andum001 10
#turnt001 9
#rojam002 9
{% endcodeblock %}</p>

<p>Because players with more at-bats hit into more errors, I need to take the number of at-bats into account. I also filter out all players with less than 250 at bats. I figure we only want players with lots of opportunities to create errors.</p>

<p>{% codeblock lang:bash %}
echo “———PLAYERS WITH MOST ERRORS PER AT BAT———-“
join -e”0” -a1 -a2 &lt;(sort -k 1 ./processed_data/${YEAR}/abs.out) -o 0 1.2 2.2 &lt;(sort -k 1 ./processed_data/${YEAR}/errors.out) | \
	uniq | \
	awk -v OFS=’, ‘ ‘$2 &gt; 250 {print $1, $3, $2, $3/$2}’ &gt;  \
	./processed_data/${YEAR}/errors_abs.out
cat ./processed_data/${YEAR}/errors_abs.out | sort -k 4 -nr | head</p>

<h1 id="players-with-most-errors-per-at-bat----------">———PLAYERS WITH MOST ERRORS PER AT BAT———-</h1>
<p>#pereh001, 8, 316, 0.0253165
#gurry001, 13, 537, 0.0242086
#andre001, 9, 395, 0.0227848
#casts001, 13, 593, 0.0219224
#desmi001, 11, 555, 0.0198198
#baezj001, 12, 606, 0.019802
#garca003, 7, 356, 0.0196629
#bogax001, 10, 512, 0.0195312
#goldp001, 11, 593, 0.0185497
#iglej001, 8, 432, 0.0185185
{% endcodeblock %}</p>

<p>At-bats is great but even better is to remove strike-outs and just look at occurences when a player hit the ball into play. I remove all players with less than 450 balls hit into play which limits us to just 37 players but the players have enough reps to make the estimates more reliable.</p>

<p>{% codeblock lang:bash %}
echo “———PLAYERS WITH MOST ERRORS PER BALL IN PLAY———-“
cat ./processed_data/${YEAR}/batters.out | \
	grep -Ev ‘SF|SH’ | \
	grep -E ‘,(S|D|T|HR|[0-9]|E|DGR|FC)’ | \
	awk -F, ‘{a[$1]++;}END{for (i in a)print i, a[i];}’ &gt; \
	./processed_data/${YEAR}/bip.out
join -e”0” -a1 -a2 &lt;(sort -k 1 ./processed_data/${YEAR}/bip.out) -o 0 1.2 2.2 &lt;(sort -k 1 ./processed_data/${YEAR}/errors.out) | \
	uniq | \
	awk -v OFS=’, ‘ ‘$2 &gt; 450 {print $1, $3, $2, $3/$2}’ &gt; \
	./processed_data/${YEAR}/errors_bip.out
cat ./processed_data/${YEAR}/errors_bip.out | sort -k 4 -nr | head</p>

<h1 id="players-with-most-errors-per-ball-in-play----------">———PLAYERS WITH MOST ERRORS PER BALL IN PLAY———-</h1>
<p>#casts001, 13, 469, 0.0277186
#gurry001, 13, 474, 0.0274262
#castn001, 10, 469, 0.021322
#andum001, 10, 476, 0.0210084
#andeb006, 9, 461, 0.0195228
#turnt001, 9, 532, 0.0169173
#simma001, 8, 510, 0.0156863
#lemad001, 7, 451, 0.0155211
#sancc001, 7, 462, 0.0151515
#freef001, 7, 486, 0.0144033
{% endcodeblock %}</p>

<p>Now we have some data. In future posts I will explore how we can use statistics to evaluate whether some players are more likely to hit into errors than others.</p>

<p>Check out the <a href="https://danvatterott.com/blog/2019/06/04/are-some-mlb-players-more-likely-to-hit-into-errors-statistics/">companion post</a> that statistically explores this question.</p>
]]></content>
  </entry>
  
</feed>
